import{a as ze,r as d,u as Be,b as z,j as e}from"./app-DkoREvhI.js";import{B as i}from"./createLucideIcon-CId_UG7q.js";import{L as N,I}from"./check-D-XOZEEh.js";import{C as Ue,a as Re,b as He,c as Le,d as Qe,T as ge,e as ve,f as w,g as f,h as Ne,i as o,B as $}from"./badge-D8sRwdKu.js";import{t as fe,D as J,a as X,P as G,b as K,c as Y,d as Z,e as ee,g as m,h as x,i as u,j as p,k as n,f as se,S as We,F as ye,C as $e,l as Je,T as Xe,A as Ge}from"./index-DstjHtLW.js";import{X as ae,A as Ke}from"./AuthenticatedLayout-XJm90pwO.js";import{C as Ye}from"./chevron-right-BeXJKm7K.js";/* empty css            */import"./index-C3q6v-G_.js";import"./index-_cVg8tae.js";function Ze(){const{orders:j={data:[]},customers:te,services:P,filters:v={},flash:D}=ze().props,[M,le]=d.useState(v.search||""),[y,ne]=d.useState(v.status||"all"),[S,re]=d.useState(v.payment_method||"all"),[O,ie]=d.useState(v.sort_by||"created_at"),[T,B]=d.useState(v.sort_direction||"desc"),[Se,U]=d.useState(!1),[Ce,R]=d.useState(!1),[_e,E]=d.useState(!1),[k,ce]=d.useState(null),[de,H]=d.useState(v.page||1),[A,oe]=d.useState([]),[g,C]=d.useState([{id:"",quantity:1,details:{}}]),L=k?.status==="pending",{data:_,setData:h,post:be,put:we,processing:he,errors:r,reset:Q,clearErrors:me}=Be({customer_id:"",services:[{id:"",quantity:1,details:{}}],status:"pending",payment_method:"cash"});d.useEffect(()=>{D?.success&&fe.success(D.success),D?.error&&fe.error(D.error)},[D]),d.useEffect(()=>{const s=setTimeout(()=>{Pe()},500);return()=>clearTimeout(s)},[M,y,S,O,T,de]);const Pe=()=>{z.get(route("orders.index"),{search:M,status:y==="all"?"":y,payment_method:S==="all"?"":S,sort_by:O,sort_direction:T,per_page:v.per_page,page:de},{preserveState:!0,replace:!0})},De=s=>{O===s?B(T==="asc"?"desc":"asc"):(ie(s),B("asc"))},Oe=()=>{Q(),me(),h({customer_id:"",services:[{id:"",quantity:1,details:{}}],status:"pending",payment_method:"cash"}),C([{id:"",quantity:1,details:{}}]),U(!0)},Te=s=>{const a=s.services?s.services.map(l=>({id:l.id,quantity:l.pivot.quantity,details:JSON.parse(l.pivot.details||"{}")})):[];h({customer_id:s.customer_id,services:a,status:s.status,payment_method:s.payment_method}),C(a),me(),ce(s),R(!0)},ke=s=>{ce(s),E(!0)},Ae=s=>{s.preventDefault(),be(route("orders.store"),{onSuccess:()=>{U(!1),Q()},onError:a=>{console.error(a)}})},Fe=s=>{s.preventDefault(),we(route("orders.update",k.id),{onSuccess:()=>{R(!1),Q()},onError:a=>{console.error(a)}})},Ie=()=>{z.delete(route("orders.destroy",k.id),{onSuccess:()=>{E(!1)},onError:s=>{console.error(s)}})},Me=()=>{le(""),ne("all"),re("all"),ie("created_at"),B("desc"),H(1)},b=s=>!s&&s!==0?"N/A":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(s),xe=s=>s?new Date(s).toLocaleDateString():"N/A",Ee=s=>{const a={pending:"secondary",paid:"default",cancelled:"destructive"};return e.jsx($,{variant:a[s]||"secondary",children:s})},qe=s=>{const a={cash:"default",online:"outline"};return e.jsx($,{variant:a[s]||"secondary",children:s})},Ve=s=>{A.includes(s)?oe(A.filter(a=>a!==s)):oe([...A,s])},ue=()=>{const s=[...g,{id:"",quantity:1,details:{}}];C(s),h("services",s)},pe=s=>{if(g.length>1){const a=[...g];a.splice(s,1),C(a),h("services",a)}},q=(s,a,l)=>{const t=[...g];if(t[s][a]=l,a==="id"){const c=P.find(W=>W.id===l);c&&(t[s].details={},c.type==="per_unit"&&(t[s].details.weight=0))}C(t),h("services",t)},V=(s,a,l)=>{const t=[...g];t[s].details[a]=l,C(t),h("services",t)},F=({field:s,children:a})=>e.jsx(f,{className:"cursor-pointer",onClick:()=>De(s),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:a}),O===s&&e.jsx(Ge,{className:`h-3 w-3 ${T==="asc"?"rotate-180":""}`})]})}),je=s=>{if(!s)return null;const a=new URL(s,window.location.origin);return a.searchParams.set("search",M),a.searchParams.set("status",y==="all"?"":y),a.searchParams.set("payment_method",S==="all"?"":S),a.searchParams.set("sort_by",O),a.searchParams.set("sort_direction",T),a.searchParams.set("per_page",v.per_page),a.pathname+"?"+a.searchParams.toString()};return e.jsx("div",{className:"container mx-auto py-2 px-4",children:e.jsxs(Ue,{className:"mb-8",children:[e.jsx(Re,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(He,{className:"text-2xl font-bold",children:"Orders"}),e.jsx(Le,{children:"Manage customer orders"})]}),e.jsxs(J,{open:Se,onOpenChange:U,children:[e.jsx(X,{asChild:!0,children:e.jsxs(i,{onClick:Oe,className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"})," Add Order"]})}),e.jsxs(K,{className:"sm:max-w-[700px]",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Create New Order"}),e.jsx(ee,{children:"Add a new customer order"})]}),e.jsxs("form",{onSubmit:Ae,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"customer_id",className:"text-right",children:"Customer *"}),e.jsxs(m,{value:_.customer_id,onValueChange:s=>h("customer_id",s),children:[e.jsx(x,{className:"col-span-3",children:e.jsx(u,{placeholder:"Select customer"})}),e.jsx(p,{children:te.map(s=>e.jsx(n,{value:s.id.toString(),children:s.name},s.id))})]}),r.customer_id&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:r.customer_id})]}),e.jsx("fieldset",{disabled:!L,children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{className:"text-right",children:"Services *"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[g.map((s,a)=>e.jsxs("div",{className:"border rounded p-3 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"font-medium",children:["Service #",a+1]}),g.length>1&&e.jsx(i,{type:"button",variant:"outline",size:"sm",onClick:()=>pe(a),children:e.jsx(ae,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[e.jsx("div",{className:"col-span-7",children:e.jsxs(m,{value:s.id,onValueChange:l=>q(a,"id",l),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select service"})}),e.jsx(p,{children:P.map(l=>e.jsx(n,{value:l.id.toString(),children:l.name},l.id))})]})}),e.jsx("div",{className:"col-span-5",children:e.jsx(I,{type:"number",min:"1",placeholder:"Quantity",value:s.quantity,onChange:l=>q(a,"quantity",parseInt(l.target.value)||1)})})]}),s.id&&(()=>{const l=P.find(t=>t.id===parseInt(s.id));return l?l.type==="selectable"?e.jsx("div",{className:"grid grid-cols-12 gap-2",children:e.jsx("div",{className:"col-span-12",children:e.jsxs(m,{value:s.details.package||"",onValueChange:t=>V(a,"package",t),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select option"})}),e.jsx(p,{children:l.options&&l.options.map((t,c)=>e.jsxs(n,{value:t.name,children:[t.name," ","-"," ",b(t.price)]},c))})]})})}):l.type==="per_unit"?e.jsx("div",{className:"grid grid-cols-12 gap-2",children:e.jsx("div",{className:"col-span-12",children:e.jsx(I,{type:"number",min:"0",step:"0.01",placeholder:"Weight/Unit",value:s.details.weight||"",onChange:t=>V(a,"weight",parseFloat(t.target.value)||0)})})}):null:null})()]},a)),e.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:ue,className:"mt-2",disabled:!L,children:[e.jsx(G,{className:"h-4 w-4 mr-1"})," ","Add Service"]}),r.services&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.services})]})]})})}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"status",className:"text-right",children:"Status *"}),e.jsxs(m,{value:_.status,onValueChange:s=>h("status",s),children:[e.jsx(x,{className:"col-span-3",children:e.jsx(u,{placeholder:"Select status"})}),e.jsxs(p,{children:[e.jsx(n,{value:"pending",children:"Pending"}),e.jsx(n,{value:"paid",children:"Paid"}),e.jsx(n,{value:"cancelled",children:"Cancelled"})]})]}),r.status&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:r.status})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"payment_method",className:"text-right",children:"Payment Method *"}),e.jsxs(m,{value:_.payment_method,onValueChange:s=>h("payment_method",s),disabled:!L,children:[e.jsx(x,{className:"col-span-3",children:e.jsx(u,{placeholder:"Select payment method"})}),e.jsxs(p,{children:[e.jsx(n,{value:"cash",children:"Cash"}),e.jsx(n,{value:"online",children:"Online"})]})]}),r.payment_method&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:r.payment_method})]})]}),e.jsx(se,{children:e.jsx(i,{type:"submit",disabled:he,children:"Create Order"})})]})]})]})]})}),e.jsxs(Qe,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(We,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(I,{placeholder:"Search orders...",value:M,onChange:s=>le(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{value:y,onValueChange:ne,children:[e.jsxs(x,{className:"w-[180px]",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),e.jsx(u,{placeholder:"Status"})]}),e.jsxs(p,{children:[e.jsx(n,{value:"all",children:"All Statuses"}),e.jsx(n,{value:"pending",children:"Pending"}),e.jsx(n,{value:"paid",children:"Paid"}),e.jsx(n,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(m,{value:S,onValueChange:re,children:[e.jsxs(x,{className:"w-[180px]",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),e.jsx(u,{placeholder:"Payment"})]}),e.jsxs(p,{children:[e.jsx(n,{value:"all",children:"All Payments"}),e.jsx(n,{value:"cash",children:"Cash"}),e.jsx(n,{value:"online",children:"Online"})]})]}),e.jsxs(i,{variant:"outline",onClick:Me,className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"})," Clear Sort & Filters"]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ge,{children:[e.jsx(ve,{children:e.jsxs(w,{children:[e.jsx(f,{className:"w-8"}),e.jsx(F,{field:"customer.name",children:"Customer"}),e.jsx(f,{children:"Country"}),e.jsx(F,{field:"status",children:"Status"}),e.jsx(F,{field:"payment_method",children:"Payment"}),e.jsx(F,{field:"total_price",children:"Total"}),e.jsx(F,{field:"created_at",children:"Date"}),e.jsx(f,{children:"Actions"})]})}),e.jsx(Ne,{children:j.length>0?j.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs(w,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>Ve(s.id),children:[e.jsx(o,{children:e.jsx(i,{variant:"ghost",size:"sm",children:A.includes(s.id)?e.jsx($e,{className:"h-4 w-4"}):e.jsx(Ye,{className:"h-4 w-4"})})}),e.jsx(o,{className:"font-medium",children:s.customer.name}),e.jsx(o,{children:s.customer.passport_country?e.jsx($,{variant:"outline",children:s.customer.passport_country}):"N/A"}),e.jsx(o,{children:Ee(s.status)}),e.jsx(o,{children:qe(s.payment_method)}),e.jsx(o,{className:"font-medium",children:b(s.total_price)}),e.jsx(o,{children:xe(s.created_at)}),e.jsx(o,{onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(J,{open:Ce&&k?.id===s.id,onOpenChange:a=>{a||R(!1)},children:[e.jsx(X,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>Te(s),children:e.jsx(Je,{className:"h-4 w-4"})})}),e.jsxs(K,{className:"sm:max-w-[700px]",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Edit Order"}),e.jsx(ee,{children:"Update order information"})]}),e.jsxs("form",{onSubmit:Fe,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"customer_id",className:"text-right",children:"Customer *"}),e.jsxs(m,{value:_.customer_id,onValueChange:a=>h("customer_id",a),children:[e.jsx(x,{className:"col-span-3",children:e.jsx(u,{placeholder:"Select customer"})}),e.jsx(p,{children:te.map(a=>e.jsx(n,{value:a.id.toString(),children:a.name},a.id))})]}),r.customer_id&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:r.customer_id})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{className:"text-right",children:"Services *"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[(g||[]).map((a,l)=>e.jsxs("div",{className:"border rounded p-3 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"font-medium",children:["Service #",l+1]}),(g||[]).length>1&&e.jsx(i,{type:"button",variant:"outline",size:"sm",onClick:()=>pe(l),children:e.jsx(ae,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[e.jsx("div",{className:"col-span-7",children:e.jsxs(m,{value:a.id,onValueChange:t=>q(l,"id",t),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select service"})}),e.jsx(p,{children:P.map(t=>e.jsx(n,{value:t.id.toString(),children:t.name},t.id))})]})}),e.jsx("div",{className:"col-span-5",children:e.jsx(I,{type:"number",min:"1",placeholder:"Quantity",value:a.quantity,onChange:t=>q(l,"quantity",parseInt(t.target.value)||1)})})]}),a.id&&(()=>{const t=P.find(c=>c.id===parseInt(a.id));return t?t.type==="selectable"?e.jsx("div",{className:"grid grid-cols-12 gap-2",children:e.jsx("div",{className:"col-span-12",children:e.jsxs(m,{value:a.details.package||"",onValueChange:c=>V(l,"package",c),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select option"})}),e.jsx(p,{children:t.options&&t.options.map((c,W)=>e.jsxs(n,{value:c.name,children:[c.name," ","-"," ",b(c.price)]},W))})]})})}):t.type==="per_unit"?e.jsx("div",{className:"grid grid-cols-12 gap-2",children:e.jsx("div",{className:"col-span-12",children:e.jsx(I,{type:"number",min:"0",step:"0.01",placeholder:"Weight/Unit",value:a.details.weight||"",onChange:c=>V(l,"weight",parseFloat(c.target.value)||0)})})}):null:null})()]},l)),e.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:ue,className:"mt-2",children:[e.jsx(G,{className:"h-4 w-4 mr-1"})," ","Add Service"]}),r.services&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.services})]})]})}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"status",className:"text-right",children:"Status *"}),e.jsxs(m,{value:_.status,onValueChange:a=>h("status",a),children:[e.jsx(x,{className:"col-span-3",children:e.jsx(u,{placeholder:"Select status"})}),e.jsxs(p,{children:[e.jsx(n,{value:"pending",children:"Pending"}),e.jsx(n,{value:"paid",children:"Paid"}),e.jsx(n,{value:"cancelled",children:"Cancelled"})]})]}),r.status&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:r.status})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"payment_method",className:"text-right",children:"Payment Method *"}),e.jsxs(m,{value:_.payment_method,onValueChange:a=>h("payment_method",a),children:[e.jsx(x,{className:"col-span-3",children:e.jsx(u,{placeholder:"Select payment method"})}),e.jsxs(p,{children:[e.jsx(n,{value:"cash",children:"Cash"}),e.jsx(n,{value:"online",children:"Online"})]})]}),r.payment_method&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:r.payment_method})]})]}),e.jsx(se,{children:e.jsx(i,{type:"submit",disabled:he,children:"Update Order"})})]})]})]}),e.jsxs(J,{open:_e&&k?.id===s.id,onOpenChange:a=>{a||E(!1)},children:[e.jsx(X,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>ke(s),children:e.jsx(Xe,{className:"h-4 w-4"})})}),e.jsxs(K,{children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Confirm Deletion"}),e.jsx(ee,{children:"Are you sure you want to delete this order? This action cannot be undone."})]}),e.jsxs(se,{children:[e.jsx(i,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),e.jsx(i,{variant:"destructive",onClick:Ie,children:"Delete"})]})]})]})]})})]},s.id),A.includes(s.id)&&e.jsx(w,{children:e.jsx(o,{colSpan:8,className:"p-4 bg-muted/20",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Order Details:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Customer Information"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",s.customer.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",s.customer.email||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",s.customer.phone||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Country:"})," ",s.customer.passport_country||"N/A"]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Order Information"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",s.status]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Payment Method:"})," ",s.payment_method]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Order Date:"})," ",xe(s.created_at)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," ",b(s.total_price)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Services"}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(ge,{children:[e.jsx(ve,{children:e.jsxs(w,{children:[e.jsx(f,{children:"Service"}),e.jsx(f,{children:"Quantity"}),e.jsx(f,{children:"Price/Unit"}),e.jsx(f,{children:"Total"})]})}),e.jsx(Ne,{children:s.services.map(a=>e.jsxs(w,{children:[e.jsx(o,{children:a.name}),e.jsx(o,{children:a.pivot.quantity}),e.jsx(o,{children:b(a.pivot.price_per_unit)}),e.jsx(o,{children:b(a.pivot.price_per_unit*a.pivot.quantity)})]},a.id))})]})})]})]})})},`${s.id}-details`)]})):e.jsx(w,{children:e.jsx(o,{colSpan:8,className:"text-center py-8",children:"No orders found"})})})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",j.length," orders"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>{const s=j.current_page-1;H(s),z.get(je(j.prev_page_url),{},{preserveState:!0})},disabled:!j.prev_page_url,children:"Previous"}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>{const s=j.current_page+1;H(s),z.get(je(j.next_page_url),{},{preserveState:!0})},disabled:!j.next_page_url,children:"Next"})]})]})]})]})})}Ze.layout=j=>e.jsx(Ke,{children:j});export{Ze as default};
