import{r as c,j as e,b as _e,c as ft,u as we}from"./app-D9VRIkeW.js";import{P as vt,T as _t,t as Q}from"./index-C1Tk4ak8.js";import{A as me,f as Ct,a as Nt}from"./date-sUREfqb9.js";import{c as Te,R as yt,W as Dt,C as St,T as kt,D as wt,a as Re,P as bt,O as At,b as Tt,X as Rt,d as Et,U as Ot,H as Pt,A as Ft}from"./AuthenticatedLayout-YMI5X6zW.js";import{u as Ee,d as It,a as R,e as Oe,B as g}from"./button-CEil9SyP.js";import{a as Bt,b as Mt,c as $t,C as Lt,d as zt}from"./card-VJI4IhOW.js";import{S as Ut,a as z,b as U,c as V,d as H,e as C,D as X,f as be,g as K,h as ee,i as te,A as Vt,j as Ht,k as Ce}from"./select-D7qJEMU0.js";import{c as Yt,a as Zt}from"./index-D7CwUK-e.js";import{P as Gt}from"./plus-93vJ37x5.js";import{I as F,L as N}from"./label-CLzS-Qwo.js";import{F as Wt}from"./funnel-CNNfTh-5.js";import{C as Ae}from"./calendar-DnQqzx8U.js";import{T as I,a as _,b as Pe,c as Fe,d as Y,e as Ie}from"./table-CmSlE4gq.js";import{B as he}from"./badge-BPShEb55.js";import{S as qt}from"./scroll-area-Din-pKP0.js";import{C as Jt}from"./chevron-down-DIy7m1ZU.js";import{I as Qt}from"./info-DmtQGUyf.js";import{T as Xt}from"./tag-mey1b900.js";/* empty css            */import"./index-BPx5MBbd.js";import"./index-B1E0rpQf.js";var Be="AlertDialog",[Kt]=Yt(Be,[Te]),w=Te(),Me=t=>{const{__scopeAlertDialog:s,...a}=t,l=w(s);return e.jsx(yt,{...l,...a,modal:!0})};Me.displayName=Be;var es="AlertDialogTrigger",ts=c.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,d=w(a);return e.jsx(Tt,{...d,...l,ref:s})});ts.displayName=es;var ss="AlertDialogPortal",$e=t=>{const{__scopeAlertDialog:s,...a}=t,l=w(s);return e.jsx(bt,{...l,...a})};$e.displayName=ss;var as="AlertDialogOverlay",Le=c.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,d=w(a);return e.jsx(At,{...d,...l,ref:s})});Le.displayName=as;var Z="AlertDialogContent",[rs,ls]=Kt(Z),ns=It("AlertDialogContent"),ze=c.forwardRef((t,s)=>{const{__scopeAlertDialog:a,children:l,...d}=t,u=w(a),h=c.useRef(null),r=Ee(s,h),x=c.useRef(null);return e.jsx(Dt,{contentName:Z,titleName:Ue,docsSlug:"alert-dialog",children:e.jsx(rs,{scope:a,cancelRef:x,children:e.jsxs(St,{role:"alertdialog",...u,...d,ref:r,onOpenAutoFocus:Zt(d.onOpenAutoFocus,i=>{i.preventDefault(),x.current?.focus({preventScroll:!0})}),onPointerDownOutside:i=>i.preventDefault(),onInteractOutside:i=>i.preventDefault(),children:[e.jsx(ns,{children:l}),e.jsx(cs,{contentRef:h})]})})})});ze.displayName=Z;var Ue="AlertDialogTitle",Ve=c.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,d=w(a);return e.jsx(kt,{...d,...l,ref:s})});Ve.displayName=Ue;var He="AlertDialogDescription",Ye=c.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,d=w(a);return e.jsx(wt,{...d,...l,ref:s})});Ye.displayName=He;var os="AlertDialogAction",Ze=c.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,d=w(a);return e.jsx(Re,{...d,...l,ref:s})});Ze.displayName=os;var Ge="AlertDialogCancel",We=c.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,{cancelRef:d}=ls(Ge,a),u=w(a),h=Ee(s,d);return e.jsx(Re,{...u,...l,ref:h})});We.displayName=Ge;var cs=({contentRef:t})=>{const s=`\`${Z}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Z}\` by passing a \`${He}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Z}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return c.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,t]),null},is=Me,ds=$e,us=Le,ms=ze,hs=Ze,xs=We,ps=Ve,gs=Ye;function js({...t}){return e.jsx(is,{"data-slot":"alert-dialog",...t})}function fs({...t}){return e.jsx(ds,{"data-slot":"alert-dialog-portal",...t})}function vs({className:t,...s}){return e.jsx(us,{"data-slot":"alert-dialog-overlay",className:R("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function _s({className:t,...s}){return e.jsxs(fs,{children:[e.jsx(vs,{}),e.jsx(ms,{"data-slot":"alert-dialog-content",className:R("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...s})]})}function Cs({className:t,...s}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:R("flex flex-col gap-2 text-center sm:text-left",t),...s})}function Ns({className:t,...s}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:R("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function ys({className:t,...s}){return e.jsx(ps,{"data-slot":"alert-dialog-title",className:R("text-lg font-semibold",t),...s})}function Ds({className:t,...s}){return e.jsx(gs,{"data-slot":"alert-dialog-description",className:R("text-muted-foreground text-sm",t),...s})}function Ss({className:t,...s}){return e.jsx(hs,{className:R(Oe(),t),...s})}function ks({className:t,...s}){return e.jsx(xs,{className:R(Oe({variant:"outline"}),t),...s})}const ws=({onAddBooking:t})=>e.jsx(Bt,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(Mt,{className:"text-2xl font-bold",children:"Bookings"}),e.jsx($t,{children:"Manage your hotel bookings"})]}),e.jsxs(g,{onClick:t,className:"flex items-center gap-2",children:[e.jsx(Gt,{className:"h-4 w-4"})," Add Booking"]})]})}),bs=({searchTerm:t,setSearchTerm:s,selectedCustomer:a,setSelectedCustomer:l,selectedRoom:d,setSelectedRoom:u,selectedStatus:h,setSelectedStatus:r,checkinDateFrom:x,setCheckinDateFrom:i,checkinDateTo:o,setCheckinDateTo:m,checkoutDateFrom:p,setCheckoutDateFrom:y,checkoutDateTo:b,setCheckoutDateTo:E,clearFilters:se,customers:G,rooms:xe})=>{const B=[{value:"all",label:"All Statuses"},{value:"reserved",label:"Reserved"},{value:"checked_in",label:"Checked In"},{value:"checked_out",label:"Checked Out"},{value:"cancelled",label:"Cancelled"}],[ae,D]=c.useState(!1),[re,A]=c.useState(!1),[M,le]=c.useState(x),[ne,oe]=c.useState(o),[$,ce]=c.useState(p),[L,ie]=c.useState(b),W=()=>{i(M),m(ne),D(!1)},O=()=>{y($),E(L),A(!1)},de=()=>{le(""),oe(""),i(""),m(""),D(!1)},pe=()=>{ce(""),ie(""),y(""),E(""),A(!1)},q=()=>!x&&!o?"Check-in Date":x&&!o?x:x&&o?`${x} - ${o}`:"Check-in Date",ge=()=>!p&&!b?"Check-out Date":p&&!b?p:p&&b?`${p} - ${b}`:"Check-out Date";return e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative md:w-1/3",children:[" ",e.jsx(Ut,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(F,{placeholder:"Search by customer or room...",value:t,onChange:j=>s(j.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:w-2/3",children:[" ",e.jsxs(z,{value:h,onValueChange:r,children:[e.jsxs(U,{className:"w-full sm:w-auto flex-grow",children:[e.jsx(Wt,{className:"mr-2 h-4 w-4"}),e.jsx(V,{placeholder:"Status"})]}),e.jsx(H,{children:B.map(j=>e.jsx(C,{value:j.value,children:j.label},j.value))})]}),e.jsxs(X,{open:ae,onOpenChange:D,children:[e.jsx(be,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"w-full sm:w-auto flex-grow justify-center text-left font-normal",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),q()]})}),e.jsxs(K,{className:"sm:max-w-96",children:[e.jsx(ee,{children:e.jsx(te,{children:"Select Check-in Date Range"})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"from-date",children:"From"}),e.jsx(F,{id:"from-date",type:"date",value:M,onChange:j=>le(j.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"to-date",children:"To"}),e.jsx(F,{id:"to-date",type:"date",value:ne,onChange:j=>oe(j.target.value)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(g,{variant:"outline",onClick:de,children:"Clear"}),e.jsx(g,{onClick:W,children:"Apply"})]})]})]})]}),e.jsxs(X,{open:re,onOpenChange:A,children:[e.jsx(be,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"w-full sm:w-auto flex-grow justify-center text-left font-normal",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),ge()]})}),e.jsxs(K,{className:"sm:max-w-96",children:[e.jsx(ee,{children:e.jsx(te,{children:"Select Check-out Date Range"})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"from-date",children:"From"}),e.jsx(F,{id:"from-date",type:"date",value:$,onChange:j=>ce(j.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"to-date",children:"To"}),e.jsx(F,{id:"to-date",type:"date",value:L,onChange:j=>ie(j.target.value)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(g,{variant:"outline",onClick:pe,children:"Clear"}),e.jsx(g,{onClick:O,children:"Apply"})]})]})]})]}),e.jsxs(g,{variant:"outline",onClick:se,className:"flex items-center gap-2",children:[e.jsx(Rt,{className:"h-4 w-4"})," Clear"]})]})]})},As={view_services:{label:"Service Menu Opened"},req_svc:{label:"Service Details Viewed"},ord_svc:{label:"Option Selected"},confirm_ord:{label:"Order Confirmed"},payment:{label:"Payment Method Chosen"},rate:{label:"Rating Submitted"},cancel:{label:"Order Cancelled"}},ve=({title:t,icon:s,headerBg:a,headerText:l,children:d})=>e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`p-2 rounded-full ${a}`,children:e.jsx(s,{className:`h-5 w-5 ${l}`})}),e.jsx("h3",{className:"text-lg font-semibold",children:t})]}),e.jsx("div",{className:"space-y-2",children:d})]}),k=({label:t,value:s,children:a})=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[t,":"]}),e.jsx("span",{className:"font-medium text-right",children:s??a??"—"})]}),Ts=({booking:t,isExpanded:s,onToggle:a,onEdit:l,onDelete:d,formatDate:u,formatDateTime:h})=>{const r=o=>{switch(o){case"checked_in":return"default";case"reserved":return"secondary";case"checked_out":return"outline";case"cancelled":return"destructive";default:return"outline"}},x=o=>{switch((o||"").toLowerCase()){case"direct":return"purple";case"ota":return"info";case"agent":return"secondary";default:return"outline"}},i=o=>o?o.split("_").map(m=>m.charAt(0).toUpperCase()+m.slice(1).toLowerCase()).join(" "):"";return e.jsxs(e.Fragment,{children:[e.jsxs(I,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:a,children:[e.jsx(_,{className:"w-12",children:e.jsx(g,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:s?e.jsx(Jt,{className:"h-4 w-4"}):e.jsx(Et,{className:"h-4 w-4"})})}),e.jsx(_,{className:"font-medium",children:t.customer.name}),e.jsx(_,{children:t.room?.room_number?e.jsxs(he,{variant:"outline",children:[t.room.room_number,t.room?.room_type?` - ${t.room.room_type.name}`:""]}):e.jsx("span",{className:"text-muted-foreground",children:"No room"})}),e.jsx(_,{children:u(t.checkin_at)}),e.jsx(_,{children:u(t.checkout_at)}),e.jsx(_,{children:e.jsx(he,{variant:r(t.status),children:i(t.status)})}),e.jsx(_,{onClick:o=>o.stopPropagation(),children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>l(t),className:"bg-secondary text-secondary-foreground",children:e.jsx(vt,{className:"h-4 w-4"})}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>d(t),className:"bg-destructive text-destructive-foreground",children:e.jsx(_t,{className:"h-4 w-4"})})]})})]}),s&&e.jsx(I,{children:e.jsx(_,{colSpan:7,className:"p-0",children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs(ve,{title:"Customer Details",icon:Ot,headerBg:"bg-blue-100",headerText:"text-blue-600",children:[e.jsx(k,{label:"Name",value:t.customer?.name}),e.jsx(k,{label:"Email",value:t.customer?.email}),e.jsx(k,{label:"Phone",value:t.customer?.phone}),e.jsx(k,{label:"Country",value:t.customer?.passport_country})]}),e.jsxs(ve,{title:"Booking Details",icon:Qt,headerBg:"bg-yellow-100",headerText:"text-yellow-600",children:[e.jsx(k,{label:"Check-in",value:u(t.checkin_at)}),e.jsx(k,{label:"Check-out",value:u(t.checkout_at)}),e.jsx(k,{label:"Status",children:e.jsx(he,{variant:r(t.status),children:i(t.status)})}),e.jsx(k,{label:"Source",children:e.jsx(he,{variant:x(t.source),children:(t.source||"—").toUpperCase()})})]}),e.jsxs(ve,{title:"Room & Notes",icon:Pt,headerBg:"bg-green-100",headerText:"text-green-600",children:[e.jsx(k,{label:"Room",value:t.room?.room_number?`#${t.room.room_number}${t.room?.room_type?` (${t.room.room_type})`:""}`:"—"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-muted-foreground mb-1",children:"Notes:"}),e.jsx("div",{className:"bg-white rounded-md border p-3 min-h-[80px]",children:t.notes||"—"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Xt,{className:"h-4 w-4 text-indigo-600"}),e.jsx("h4",{className:"font-semibold text-sm",children:"Interaction History"})]}),e.jsx("div",{className:"border rounded-lg bg-background overflow-hidden",children:e.jsx(qt,{className:"h-64",children:e.jsxs(Pe,{children:[e.jsx(Fe,{children:e.jsxs(I,{children:[e.jsx(Y,{children:"Interaction"}),e.jsx(Y,{children:"Details"}),e.jsx(Y,{children:"Date"})]})}),e.jsx(Ie,{children:t.interactions&&t.interactions.length>0?t.interactions.map(o=>{const m=As[o.interaction_type]?.label||i(o.interaction_type);let p=o.details;return o.interaction_type==="view_services"?p="-":o.interaction_type==="payment"&&o.metadata?.method&&(p=i(o.metadata.method)),e.jsxs(I,{children:[e.jsx(_,{children:m}),e.jsx(_,{children:p}),e.jsx(_,{className:"text-muted-foreground text-sm",children:h(o.created_at)})]},o.id)}):e.jsx(I,{children:e.jsx(_,{colSpan:3,className:"h-24 text-center text-muted-foreground",children:"No interaction history found."})})})]})})})]})]})})})]})},Rs=({bookings:t,expandedRows:s,toggleRow:a,openEditModal:l,openDeleteModal:d,formatDate:u,formatDateTime:h,sortBy:r,sortDirection:x,handleSort:i})=>{const o=({field:m,children:p})=>e.jsx(Y,{className:"cursor-pointer",onClick:()=>i(m),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:p}),r===m&&e.jsx(Vt,{className:`h-3 w-3 ${x==="asc"?"rotate-180":""}`})]})});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(Pe,{children:[e.jsx(Fe,{children:e.jsxs(I,{children:[e.jsx(Y,{className:"w-8"}),e.jsx(o,{field:"customer_name",children:"Customer"}),e.jsx(o,{field:"room_number",children:"Room"}),e.jsx(o,{field:"checkin_at",children:"Check-in"}),e.jsx(o,{field:"checkout_at",children:"Check-out"}),e.jsx(o,{field:"status",children:"Status"}),e.jsx(Y,{children:"Actions"})]})}),e.jsx(Ie,{children:t.length>0?t.map(m=>e.jsx(Ts,{booking:m,isExpanded:s.includes(m.id),onToggle:()=>a(m.id),onEdit:()=>l(m),onDelete:()=>d(m),formatDate:u,formatDateTime:h},m.id)):e.jsx(I,{children:e.jsx(_,{colSpan:7,className:"text-center py-8",children:"No bookings found"})})})]})})},qe=t=>{if(!t)return null;const s=new Date(t);return isNaN(s)?null:s},Je=t=>{const s=qe(t);if(!s)return!1;const a=new Date;return s.getFullYear()===a.getFullYear()&&s.getMonth()===a.getMonth()&&s.getDate()===a.getDate()},Es=t=>{const s=qe(t);if(!s)return!1;const a=new Date;return s.getTime()>a.getTime()&&!Je(t)},Os=({data:t,setData:s,errors:a,customers:l,rooms:d})=>{const u=c.useMemo(()=>Je(t.checkin_at),[t.checkin_at]),h=c.useMemo(()=>Es(t.checkin_at),[t.checkin_at]);return c.useEffect(()=>{h?t.status!=="reserved"&&s("status","reserved"):u?["reserved","checked_in"].includes(t.status)||s("status","reserved"):t.status!=="reserved"&&s("status","reserved")},[u,h]),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"customer_id",className:"text-right",children:"Customer *"}),e.jsxs("div",{className:"col-span-3 flex gap-2",children:[e.jsxs(z,{id:"customer_id",value:t.customer_id?String(t.customer_id):"",onValueChange:r=>s("customer_id",r),className:"min-w-0 flex-1",children:[e.jsx(U,{className:"min-w-0",children:e.jsx(V,{placeholder:"Select a customer"})}),e.jsx(H,{children:l.map(r=>e.jsx(C,{value:String(r.id),children:r.name},r.id))})]}),e.jsx(g,{type:"button",variant:"outline",className:"whitespace-nowrap",children:"+ Add Customer"})]}),a.customer_id&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:a.customer_id})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"source",className:"text-right",children:"Source *"}),e.jsxs(z,{id:"source",value:t.source||"direct",onValueChange:r=>s("source",r),className:"col-span-3",children:[e.jsx(U,{children:e.jsx(V,{placeholder:"Select source"})}),e.jsxs(H,{children:[e.jsx(C,{value:"direct",children:"Direct"}),e.jsx(C,{value:"ota",children:"OTA"}),e.jsx(C,{value:"agent",children:"Agent"})]})]}),a.source&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:a.source})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"room_id",className:"text-right",children:"Room *"}),e.jsxs(z,{id:"room_id",value:t.room_id?String(t.room_id):"",onValueChange:r=>s("room_id",r),className:"col-span-3",children:[e.jsx(U,{children:e.jsx(V,{placeholder:"Select a room"})}),e.jsx(H,{children:d.map(r=>e.jsxs(C,{value:String(r.id),children:[r.room_number," -"," ",r.room_type?r.room_type.name:"N/A"]},r.id))})]}),a.room_id&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:a.room_id})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"checkin_at",className:"text-right",children:"Check-in *"}),e.jsx(F,{id:"checkin_at",type:"datetime-local",value:t.checkin_at||"",onChange:r=>s("checkin_at",r.target.value),className:"col-span-3"}),a.checkin_at&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:a.checkin_at})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"checkout_at",className:"text-right",children:"Check-out *"}),e.jsx(F,{id:"checkout_at",type:"datetime-local",value:t.checkout_at||"",onChange:r=>s("checkout_at",r.target.value),className:"col-span-3"}),a.checkout_at&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:a.checkout_at})]}),u&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"status",className:"text-right",children:"Status *"}),e.jsxs(z,{id:"status",value:t.status||"reserved",onValueChange:r=>s("status",r),className:"col-span-3",children:[e.jsx(U,{children:e.jsx(V,{placeholder:"Select status"})}),e.jsxs(H,{children:[e.jsx(C,{value:"reserved",children:"Reserved"}),e.jsx(C,{value:"checked_in",children:"Checked In"})]})]}),a.status&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:a.status})]})]})},Ps=({isOpen:t,onOpenChange:s,onConfirm:a,booking:l})=>l?e.jsx(X,{open:t,onOpenChange:s,children:e.jsxs(K,{children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Confirm Deletion"}),e.jsxs(Ht,{children:["Are you sure you want to delete the booking for ",e.jsx("strong",{children:l.customer_name})," in room ",e.jsx("strong",{children:l.room_number}),"? This action cannot be undone."]})]}),e.jsxs(Ce,{children:[e.jsx(g,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(g,{variant:"destructive",onClick:a,children:"Delete"})]})]})}):null,Fs=({paginationData:t,buildPaginationUrl:s})=>{const{from:a,to:l,total:d,prev_page_url:u,next_page_url:h,current_page:r}=t,x=i=>{i&&_e.get(s(i),{},{preserveState:!0,replace:!0})};return e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",a," to ",l," of ",d," results"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>x(u),disabled:!u,children:"Previous"}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>x(h),disabled:!h,children:"Next"})]})]})},Is=(t,s="Asia/Jakarta")=>{if(!t)return console.warn("[isFutureInTz] iso is empty/null"),!1;const a=new Date(t),l=new Date,d=i=>{const o=new Intl.DateTimeFormat("en-CA",{timeZone:s,hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(i),m=p=>+o.find(y=>y.type===p).value;return[m("year"),m("month"),m("day"),m("hour"),m("minute"),m("second")]},u=d(a),h=d(l);let r=0;for(let i=0;i<u.length;i++)if(u[i]!==h[i]){r=u[i]>h[i]?1:-1;break}const x=new Intl.DateTimeFormat("en-GB",{timeZone:s,dateStyle:"full",timeStyle:"medium",hour12:!1});return console.group("[isFutureInTz] debug"),console.log("TZ:",s),console.log("iso:",t),console.log("target (toString):",a.toString(),"| epoch:",a.getTime()),console.log("now    (toString):",l.toString(),"| epoch:",l.getTime()),console.log("target in TZ:",x.format(a),"| tuple:",u),console.log("now    in TZ:",x.format(l),"| tuple:",h),console.log("compare result:",r===0?"EQUAL":r>0?"FUTURE":"PAST"),console.groupEnd(),r>0},Bs=(t,s="Asia/Jakarta")=>{if(!t)return!1;const a=new Date(t),l=new Date,d=x=>{const i=new Intl.DateTimeFormat("en-CA",{timeZone:s,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(x),o=m=>+i.find(p=>p.type===m).value;return[o("year"),o("month"),o("day")]},u=d(a),h=d(l),r=u[0]===h[0]&&u[1]===h[1]&&u[2]===h[2];return console.log("[isSameDayInTz]",{tz:s,iso:t,targetYMD:u,nowYMD:h,same:r}),r};function Ms(){const{bookings:t,filters:s,flash:a,customers:l,rooms:d}=ft().props,[u,h]=c.useState(s.search||""),[r,x]=c.useState(s.customer_id||"all"),[i,o]=c.useState(s.room_id||"all"),[m,p]=c.useState(s.status||"all"),[y,b]=c.useState(s.checkin_date_from||""),[E,se]=c.useState(s.checkin_date_to||""),[G,xe]=c.useState(s.checkout_date_from||""),[B,ae]=c.useState(s.checkout_date_to||""),[D,re]=c.useState(s.sort_by||"created_at"),[A,M]=c.useState(s.sort_direction||"desc"),[le,ne]=c.useState([]),[oe,$]=c.useState(!1),[ce,L]=c.useState(!1),[ie,W]=c.useState(!1),[O,de]=c.useState(null),{data:pe,setData:q,post:ge,processing:j,errors:Qe,reset:je,clearErrors:Xe}=we({customer_id:"",room_id:"",checkin_at:"",checkout_at:"",status:"reserved",notes:"",source:"direct"}),{data:P,setData:f,put:Ke,processing:Ne,errors:ye,reset:De,clearErrors:et}=we({customer_id:"",room_id:"",checkin_at:"",checkout_at:"",notes:"",status:"",override_future_checkin:!1,source:""}),[tt,J]=c.useState(!1),ue=c.useRef("reserved"),S=c.useRef(null),Se=Is(P?.checkin_at,me),ke=Bs(P?.checkin_at,me),fe=Se&&!ke;console.log("[Bookings.jsx] future-check flags",{checkin_at:P?.checkin_at,APP_TIMEZONE:me,strictlyFutureDateTime:Se,sameDayAsToday:ke,final_isFutureCheckin:fe}),c.useEffect(()=>{a?.success&&Q.success(a.success),a?.error&&Q.error(a.error)},[a]),c.useEffect(()=>{const n=setTimeout(()=>st(1),400);return()=>clearTimeout(n)},[u,r,i,m,y,E,G,B,D,A]);const st=(n=s.page||1)=>{_e.get(route("bookings.index"),{search:u,customer_id:r==="all"?"":r,room_id:i==="all"?"":i,status:m==="all"?"":m,checkin_date_from:y,checkin_date_to:E,checkout_date_from:G,checkout_date_to:B,sort_by:D,sort_direction:A,page:n},{preserveState:!0,replace:!0})},at=n=>{D===n?M(T=>T==="asc"?"desc":"asc"):(re(n),M("asc"))},rt=()=>{h(""),x("all"),o("all"),p("all"),b(""),se(""),xe(""),ae(""),re("created_at"),M("desc")},lt=n=>ne(T=>T.includes(n)?T.filter(v=>v!==n):[...T,n]),nt=n=>{if(!n)return null;const T=new URL(n),v=new URLSearchParams(T.search);return v.set("search",u),v.set("customer_id",r==="all"?"":r),v.set("room_id",i==="all"?"":i),v.set("status",m==="all"?"":m),v.set("checkin_date_from",y),v.set("checkin_date_to",E),v.set("checkout_date_from",G),v.set("checkout_date_to",B),v.set("sort_by",D),v.set("sort_direction",A),`${T.pathname}?${v.toString()}`},ot=()=>{je(),Xe(),q("status","reserved"),q("source","direct"),$(!0)},ct=n=>{console.group("[openEditModal]"),console.log("booking:",n),console.log("now (client):",new Date().toString()),console.groupEnd(),de(n),De(),et(),f("customer_id",n.customer_id?.toString()||""),f("room_id",n.room_id?.toString()||""),f("checkin_at",n.checkin_at||""),f("checkout_at",n.checkout_at||""),f("notes",n.notes||""),f("status",n.status||"reserved"),f("override_future_checkin",!1),f("source",n.source||"direct"),ue.current=n.status||"reserved",S.current=null,L(!0)},it=n=>{de(n),W(!0)},dt=n=>{n.preventDefault(),ge(route("bookings.store"),{onSuccess:()=>{$(!1),je(),Q.success("Booking created successfully.")}})},ut=n=>{if(console.log("[handleChangeStatus]",{from:P.status,to:n,isFutureCheckin:fe,checkin_at:P.checkin_at,tz:me}),n==="checked_in"&&fe){S.current=n,J(!0);return}S.current=null,f("status",n),f("override_future_checkin",!1)},mt=()=>{console.log("[confirmFutureCheckin] proceed with checked_in despite future checkin time"),S.current&&(f("status",S.current),f("override_future_checkin",!0),ue.current=S.current,S.current=null,J(!1))},ht=()=>{console.log("[cancelFutureCheckin] back to previous:",ue.current),f("status",ue.current||"reserved"),f("override_future_checkin",!1),S.current=null,J(!1)},xt=n=>{n.preventDefault(),O&&(console.group("[handleUpdate] payload"),console.log(P),console.groupEnd(),Ke(route("bookings.update",O.id),{onSuccess:()=>{L(!1),Q.success("Booking updated successfully.")}}))},pt=()=>{O&&_e.delete(route("bookings.destroy",O.id),{onSuccess:()=>{W(!1),Q.success("Booking deleted successfully.")}})},gt=Nt,jt=Ct;return e.jsxs("div",{className:"container mx-auto py-2 px-4",children:[e.jsxs(Lt,{className:"mb-8",children:[e.jsx(ws,{onAddBooking:ot}),e.jsxs(zt,{children:[e.jsx(bs,{searchTerm:u,setSearchTerm:h,selectedCustomer:r,setSelectedCustomer:x,selectedRoom:i,setSelectedRoom:o,selectedStatus:m,setSelectedStatus:p,checkinDateFrom:y,setCheckinDateFrom:b,checkinDateTo:E,setCheckinDateTo:se,checkoutDateFrom:G,setCheckoutDateFrom:xe,checkoutDateTo:B,setCheckoutDateTo:ae,clearFilters:rt,customers:l,rooms:d}),e.jsx(Rs,{bookings:t.data,expandedRows:le,toggleRow:lt,openEditModal:ct,openDeleteModal:it,formatDate:gt,formatDateTime:jt,sortBy:D,sortDirection:A,handleSort:at}),e.jsx(Fs,{paginationData:t,buildPaginationUrl:nt})]})]}),e.jsx(X,{open:oe,onOpenChange:n=>{$(n),n||je()},children:e.jsxs(K,{className:"sm:max-w-[520px]",children:[e.jsx(ee,{children:e.jsx(te,{children:"Create Booking"})}),e.jsxs("form",{onSubmit:dt,children:[e.jsx(Os,{data:pe,setData:q,errors:Qe,customers:l,rooms:d}),e.jsx(Ce,{children:e.jsx(g,{type:"submit",disabled:j,children:j?"Submitting...":"Create Booking"})})]})]})}),e.jsx(X,{open:ce,onOpenChange:n=>{L(n),n||(De(),J(!1),S.current=null)},children:e.jsxs(K,{className:"sm:max-w-[420px]",children:[e.jsx(ee,{children:e.jsx(te,{children:"Edit Booking Status"})}),e.jsxs("form",{onSubmit:xt,children:[e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("div",{className:"text-right text-sm font-medium",children:"Status"}),e.jsxs("div",{className:"col-span-3",children:[e.jsxs(z,{value:P.status||"reserved",onValueChange:ut,children:[e.jsx(U,{children:e.jsx(V,{placeholder:"Select status"})}),e.jsxs(H,{children:[e.jsx(C,{value:"reserved",children:"Reserved"}),e.jsx(C,{value:"checked_in",children:"Checked In"}),e.jsx(C,{value:"checked_out",children:"Checked Out"}),e.jsx(C,{value:"cancelled",children:"Cancelled"})]})]}),ye?.status&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:ye.status})]})]})}),e.jsx(Ce,{children:e.jsx(g,{type:"submit",disabled:Ne,children:Ne?"Saving...":"Save Changes"})})]})]})}),e.jsx(js,{open:tt,onOpenChange:J,children:e.jsxs(_s,{children:[e.jsxs(Cs,{children:[e.jsx(ys,{children:"Set to Checked In with a future check-in time?"}),e.jsxs(Ds,{children:["This booking's check-in time is in the future. Setting it to ",e.jsx("b",{children:"Checked In"})," can create data inconsistencies. Proceed only if you understand this (e.g., testing or special case). You can change it back later."]})]}),e.jsxs(Ns,{children:[e.jsx(ks,{onClick:ht,children:"Cancel"}),e.jsx(Ss,{onClick:mt,children:"Proceed"})]})]})}),e.jsx(Ps,{isOpen:ie,onOpenChange:W,onConfirm:pt,booking:O})]})}Ms.layout=t=>e.jsx(Ft,{children:t});export{Ms as default};
