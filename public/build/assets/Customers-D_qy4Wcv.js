import{j as e,r as i,b as U,c as Fe,u as J}from"./app-CyNV4xla.js";import{B as j}from"./button-CxkxaUXA.js";import{a as Le,b as Ie,c as Ue,C as He,d as $e}from"./card-C7DOrj8d.js";import{S as ze,a as K,b as Q,c as Y,d as Z,e as ee,D as R,f as Ve,g as M,h as P,i as O,C as qe,A as Ge,j as H,k as $}from"./select-D1oHE82z.js";import{P as We,T as Xe,t as se}from"./index-lk-SwVZz.js";import{X as Je,d as Ke,A as Qe}from"./AuthenticatedLayout-_OcRwaJT.js";import{P as Ye}from"./plus-CY3rKiNZ.js";import{I as A,L as z}from"./index-BzOwoEwx.js";import{F as te}from"./funnel-C6VIQAg6.js";import{C as Ze}from"./calendar-BADSFOZm.js";import{T as S,a as p,b as re,c as le,d as v,e as ne}from"./table-COKPj6eX.js";import{B as I}from"./badge-CLtzMiH2.js";import{S as es}from"./scroll-area-BKDP1Es3.js";/* empty css            */import"./index-CDm6i81c.js";import"./index-DnOCixzh.js";const ss=({onAddCustomer:s})=>e.jsx(Le,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(Ie,{className:"text-2xl font-bold",children:"Customers"}),e.jsx(Ue,{children:"Manage your customer database"})]}),e.jsxs(j,{onClick:s,className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-4 w-4"})," Add Customer"]})]})}),ts=({searchTerm:s,setSearchTerm:r,selectedCountry:o,setSelectedCountry:m,selectedMembership:l,setSelectedMembership:c,lastVisitFrom:h,setLastVisitFrom:x,lastVisitTo:a,setLastVisitTo:n,clearFilters:u,countries:b})=>{const E=[{value:"all",label:"All Memberships"},{value:"regular",label:"Regular"},{value:"silver",label:"Silver"},{value:"gold",label:"Gold"},{value:"platinum",label:"Platinum"}],[N,y]=i.useState(!1),[C,w]=i.useState(h),[k,_]=i.useState(a),B=()=>{x(C),n(k),y(!1)},D=()=>{w(""),_(""),x(""),n(""),y(!1)},F=()=>!h&&!a?"Select Last Visit Range":h&&!a?h:h&&a?`${h} - ${a}`:"Select Last Visit Range";return e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(A,{placeholder:"Search customers...",value:s,onChange:d=>r(d.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(K,{value:o,onValueChange:m,children:[e.jsxs(Q,{className:"w-full md:w-[180px]",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),e.jsx(Y,{placeholder:"Country"})]}),e.jsx(Z,{children:b.map(d=>e.jsx(ee,{value:d,children:d==="all"?"All Countries":d},d))})]}),e.jsxs(K,{value:l,onValueChange:c,children:[e.jsxs(Q,{className:"w-full md:w-[180px]",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),e.jsx(Y,{placeholder:"Membership"})]}),e.jsx(Z,{children:E.map(d=>e.jsx(ee,{value:d.value,children:d.label},d.value))})]}),e.jsxs(R,{open:N,onOpenChange:y,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:"w-full md:w-52 justify-center text-left font-normal",children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),F()]})}),e.jsxs(M,{className:"sm:max-w-96",children:[e.jsx(P,{children:e.jsx(O,{children:"Select Last Visit Range"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"from-date",children:"From Date"}),e.jsx(A,{id:"from-date",type:"date",value:C,onChange:d=>w(d.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"to-date",children:"To Date"}),e.jsx(A,{id:"to-date",type:"date",value:k,onChange:d=>_(d.target.value)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(j,{variant:"outline",onClick:D,children:"Clear"}),e.jsx(j,{onClick:B,children:"Apply"})]})]})]})]}),e.jsxs(j,{variant:"outline",onClick:u,className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4"})," Clear"]})]})]})},as=({customer:s,isExpanded:r,onToggle:o,onEdit:m,onDelete:l,formatDate:c})=>{const h=a=>{switch(a){case"platinum":return"default";case"gold":return"warning";case"silver":return"outline";default:return"destructive"}},x=a=>a.split("_").map(n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join(" ");return e.jsxs(e.Fragment,{children:[e.jsxs(S,{className:"cursor-pointer hover:bg-muted/50",onClick:o,children:[e.jsx(p,{children:e.jsx(j,{variant:"ghost",size:"sm",children:r?e.jsx(qe,{className:"h-4 w-4"}):e.jsx(Ke,{className:"h-4 w-4"})})}),e.jsx(p,{className:"font-medium",children:s.name}),e.jsx(p,{children:s.email||"N/A"}),e.jsx(p,{children:s.phone||"N/A"}),e.jsx(p,{children:s.passport_country&&e.jsx(I,{variant:"outline",children:s.passport_country})}),e.jsx(p,{children:s.birth_date?c(s.birth_date):"N/A"}),e.jsx(p,{children:e.jsxs(I,{variant:"outline",children:[s.total_visits," ",s.total_visits>1?"Visits":"Visit"]})}),e.jsx(p,{children:s.membership?e.jsxs(I,{variant:h(s.membership.membership_type),children:[x(s.membership.membership_type),s.membership.discount_percentage>0&&` (${s.membership.discount_percentage}%)`]}):e.jsx("span",{className:"text-muted-foreground",children:"None"})}),e.jsx(p,{onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:m,className:"bg-secondary text-secondary-foreground",children:e.jsx(We,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:l,className:"bg-destructive text-destructive-foreground",children:e.jsx(Xe,{className:"h-4 w-4"})})]})})]}),r&&e.jsx(S,{children:e.jsx(p,{colSpan:9,className:"p-4 bg-muted/20",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.notes||"No notes for this customer."})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Booking History"}),s.bookings&&s.bookings.length>0?e.jsx("div",{className:"border rounded-md bg-background",children:e.jsx(es,{className:"h-64",children:e.jsxs(re,{children:[e.jsx(le,{children:e.jsxs(S,{children:[e.jsx(v,{children:"Check-in Date"}),e.jsx(v,{children:"Room"}),e.jsx(v,{children:"Status"})]})}),e.jsx(ne,{children:s.bookings.map(a=>e.jsxs(S,{children:[e.jsx(p,{children:c(a.checkin_at)}),e.jsx(p,{children:a.room_number||"N/A"}),e.jsx(p,{children:x(a.status)})]},a.id))})]})})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No booking history found."})]})]})})},`${s.id}-details`)]})},rs=({customers:s,expandedRows:r,toggleRow:o,openEditModal:m,openDeleteModal:l,formatDate:c,sortBy:h,sortDirection:x,handleSort:a})=>{const n=({field:u,children:b})=>e.jsx(v,{className:"cursor-pointer",onClick:()=>a(u),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:b}),h===u&&e.jsx(Ge,{className:`h-3 w-3 ${x==="asc"?"rotate-180":""}`})]})});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(re,{children:[e.jsx(le,{children:e.jsxs(S,{children:[e.jsx(v,{className:"w-8"}),e.jsx(n,{field:"name",children:"Name"}),e.jsx(n,{field:"email",children:"Email"}),e.jsx(n,{field:"phone",children:"Phone"}),e.jsx(n,{field:"passport_country",children:"Country"}),e.jsx(n,{field:"birth_date",children:"Birth Date"})," ",e.jsx(n,{field:"total_visits",children:"Visits"}),e.jsx(v,{children:"Membership"}),e.jsx(v,{children:"Actions"})]})}),e.jsx(ne,{children:s.length>0?s.map(u=>e.jsx(as,{customer:u,isExpanded:r.includes(u.id),onToggle:()=>o(u.id),onEdit:()=>m(u),onDelete:()=>l(u),formatDate:c},u.id)):e.jsx(S,{children:e.jsx(p,{colSpan:10,className:"text-center py-8",children:"No customers found"})})})]})})},ae=({data:s,setData:r,errors:o})=>{const m=[{id:"name",label:"Name *",type:"text"},{id:"email",label:"Email",type:"email"},{id:"phone",label:"Phone",type:"text"},{id:"passport_country",label:"Country",type:"text"},{id:"birth_date",label:"Birth Date",type:"date"},{id:"notes",label:"Notes",type:"text"}];return e.jsx("div",{className:"grid gap-4 py-4",children:m.map(l=>e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(z,{htmlFor:l.id,className:"text-right",children:l.label}),e.jsx(A,{id:l.id,type:l.type,value:s[l.id]||"",onChange:c=>r(l.id,c.target.value),className:"col-span-3"}),o[l.id]&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:o[l.id]})]},l.id))})},ls=({isOpen:s,onOpenChange:r,onConfirm:o,customer:m})=>m?e.jsx(R,{open:s,onOpenChange:r,children:e.jsxs(M,{children:[e.jsxs(P,{children:[e.jsx(O,{children:"Confirm Deletion"}),e.jsxs(H,{children:["Are you sure you want to delete ",e.jsx("strong",{children:m.name}),"? This action cannot be undone."]})]}),e.jsxs($,{children:[e.jsx(j,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsx(j,{variant:"destructive",onClick:o,children:"Delete"})]})]})}):null,ns=({paginationData:s,buildPaginationUrl:r})=>{const{from:o,to:m,total:l,prev_page_url:c,next_page_url:h,current_page:x}=s,a=n=>{n&&U.get(r(n),{},{preserveState:!0,replace:!0})};return e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",o," to ",m," of ",l," results"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>a(c),disabled:!c,children:"Previous"}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>a(h),disabled:!h,children:"Next"})]})]})};function is(){const{customers:s,filters:r,flash:o}=Fe().props,[m,l]=i.useState(r.search||""),[c,h]=i.useState(r.passport_country||"all"),[x,a]=i.useState(r.membership_type||"all"),[n,u]=i.useState(r.last_visit_from||""),[b,E]=i.useState(r.last_visit_to||""),[N,y]=i.useState(r.sort_by||"created_at"),[C,w]=i.useState(r.sort_direction||"desc"),[k,_]=i.useState(!1),[B,D]=i.useState(!1),[F,d]=i.useState(!1),[T,L]=i.useState(null),[ie,oe]=i.useState(["all"]),[ce,de]=i.useState([]),V={name:"",email:"",phone:"",passport_country:"",birth_date:"",notes:""},{data:me,setData:he,post:xe,processing:ue,errors:pe,reset:q,clearErrors:je,setDefaults:ge}=J(V),G={name:"",email:"",phone:"",passport_country:"",birth_date:"",notes:""},{data:fe,setData:W,put:be,processing:Ce,errors:ve,reset:X,clearErrors:Ne,setDefaults:ye}=J(G);i.useEffect(()=>{const t=[...new Set(s.data.map(g=>g.passport_country).filter(Boolean))];oe(["all",...t])},[s]),i.useEffect(()=>{o?.success&&se.success(o.success),o?.error&&se.error(o.error)},[o]),i.useEffect(()=>{const t=setTimeout(()=>_e(1),500);return()=>clearTimeout(t)},[m,c,x,n,b,N,C]);const _e=(t=r.page||1)=>{U.get(route("customers.index"),{search:m,passport_country:c==="all"?"":c,membership_type:x==="all"?"":x,last_visit_from:n,last_visit_to:b,sort_by:N,sort_direction:C,page:t},{preserveState:!0,replace:!0})},De=t=>{y(t),w(g=>g==="asc"?"desc":"asc")},Se=()=>{ge(V),q(),je(),D(!1),L(null),_(!0)},we=t=>{Te(t),Ne(),L(t),D(!0)},Te=t=>{ye(G),X(),W(g=>({...g,name:t.name??"",email:t.email??"",phone:t.phone??"",passport_country:t.passport_country??"",birth_date:t.birth_date??"",notes:t.notes??""}))},Ee=t=>{L(t),d(!0)},ke=t=>{t.preventDefault(),xe(route("customers.store"),{onSuccess:()=>{_(!1),q()}})},Ae=t=>{t.preventDefault(),T&&be(route("customers.update",T.id),{onSuccess:()=>{D(!1),X()}})},Re=()=>{T&&U.delete(route("customers.destroy",T.id),{onSuccess:()=>d(!1)})},Me=()=>{l(""),h("all"),a("all"),u(""),E(""),y("created_at"),w("desc")},Pe=t=>t?new Date(t).toLocaleDateString():"N/A",Oe=t=>de(g=>g.includes(t)?g.filter(f=>f!==t):[...g,t]),Be=t=>{if(!t)return null;const g=new URL(t),f=new URLSearchParams(g.search);return f.set("search",m),f.set("passport_country",c==="all"?"":c),f.set("membership_type",x==="all"?"":x),f.set("last_visit_from",n),f.set("last_visit_to",b),f.set("sort_by",N),f.set("sort_direction",C),`${g.pathname}?${f.toString()}`};return e.jsxs("div",{className:"container mx-auto py-2 px-4",children:[e.jsxs(He,{className:"mb-8",children:[e.jsx(ss,{onAddCustomer:Se}),e.jsxs($e,{children:[e.jsx(ts,{searchTerm:m,setSearchTerm:l,selectedCountry:c,setSelectedCountry:h,selectedMembership:x,setSelectedMembership:a,lastVisitFrom:n,setLastVisitFrom:u,lastVisitTo:b,setLastVisitTo:E,clearFilters:Me,countries:ie}),e.jsx(rs,{customers:s.data,expandedRows:ce,toggleRow:Oe,openEditModal:we,openDeleteModal:Ee,formatDate:Pe,sortBy:N,sortDirection:C,handleSort:De}),e.jsx(ns,{paginationData:s,buildPaginationUrl:Be})]})]}),e.jsx(R,{open:k,onOpenChange:_,children:e.jsxs(M,{className:"sm:max-w-[425px]",children:[e.jsxs(P,{children:[e.jsx(O,{children:"Create New Customer"}),e.jsx(H,{children:"Add a new customer to your database"})]}),e.jsxs("form",{onSubmit:ke,children:[e.jsx(ae,{data:me,setData:he,errors:pe}),e.jsx($,{children:e.jsx(j,{type:"submit",disabled:ue,children:"Create Customer"})})]})]})}),e.jsx(R,{open:B,onOpenChange:D,children:e.jsxs(M,{className:"sm:max-w-[425px]",children:[e.jsxs(P,{children:[e.jsx(O,{children:"Edit Customer"}),e.jsx(H,{children:"Update customer information"})]}),e.jsxs("form",{onSubmit:Ae,children:[e.jsx(ae,{data:fe,setData:W,errors:ve}),e.jsx($,{children:e.jsx(j,{type:"submit",disabled:Ce,children:"Update Customer"})})]})]})}),e.jsx(ls,{isOpen:F,onOpenChange:d,onConfirm:Re,customer:T})]})}is.layout=s=>e.jsx(Qe,{children:s});export{is as default};
