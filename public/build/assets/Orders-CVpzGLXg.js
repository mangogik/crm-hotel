import{j as e,b as H,c as Re,r as g,u as qe}from"./app-EWpIB3HM.js";import{B as N}from"./button-H6AwmmAM.js";import{a as Be,b as ze,c as Ue,C as Ve,d as He}from"./card-RKJWBewB.js";import{P as de,C as Le,e as $e,T as Qe,t as L,D as $,b as Q,c as J,d as W,f as X,g as G}from"./index-CkhVk1HJ.js";import{T as I,a as v,B as K,b as oe,c as he,d as C,e as me}from"./badge-CSf3a6Wm.js";import{X as ue,A as Je}from"./AuthenticatedLayout-DQWAbSsw.js";import{I as Y}from"./index-BIX3n7Yj.js";import{S as We,a as _,b as D,F as V,c as O,d as P,e as u,C as Xe,A as Ge}from"./select-DuMT9J0t.js";import{L as M}from"./label-CzG679bL.js";/* empty css            */import"./index-6H-wcPrJ.js";import"./index-CaT8ubQ7.js";const Ke=({onAddOrder:a})=>e.jsx(Be,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(ze,{className:"text-2xl font-bold",children:"Orders"}),e.jsx(Ue,{children:"Manage customer orders"})]}),e.jsxs(N,{onClick:a,className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"})," Add Order"]})]})}),Ye=({searchTerm:a,setSearchTerm:d,selectedStatus:n,setSelectedStatus:r,selectedPaymentMethod:x,setSelectedPaymentMethod:f,selectedCountry:p,setSelectedCountry:j,clearFilters:h,countries:b})=>e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(We,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(Y,{placeholder:"Search orders...",value:a,onChange:o=>d(o.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{value:n,onValueChange:r,children:[e.jsxs(D,{className:"w-[180px]",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),e.jsx(O,{placeholder:"Status"})]}),e.jsxs(P,{children:[e.jsx(u,{value:"all",children:"All Statuses"}),e.jsx(u,{value:"pending",children:"Pending"}),e.jsx(u,{value:"paid",children:"Paid"}),e.jsx(u,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(_,{value:p,onValueChange:j,children:[e.jsxs(D,{className:"w-[180px]",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),e.jsx(O,{placeholder:"Country"})]}),e.jsxs(P,{children:[e.jsx(u,{value:"all",children:"All Countries"}),b.map(o=>e.jsx(u,{value:o,children:o},o))]})]}),e.jsxs(_,{value:x,onValueChange:f,children:[e.jsxs(D,{className:"w-[180px]",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),e.jsx(O,{placeholder:"Payment"})]}),e.jsxs(P,{children:[e.jsx(u,{value:"all",children:"All Payments"}),e.jsx(u,{value:"cash",children:"Cash"}),e.jsx(u,{value:"online",children:"Online"})]})]}),e.jsxs(N,{variant:"outline",onClick:h,className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"})," Clear Sort & Filters"]})]})]}),Ze=({order:a,isExpanded:d,onToggle:n,onEdit:r,onDelete:x,getStatusBadge:f,getPaymentBadge:p,formatPrice:j,formatDate:h})=>{const b=a.status==="pending",o=t=>{t.stopPropagation(),b?r():L.info("Pesanan ini telah diproses dan tidak dapat diubah.")},w=t=>{t.stopPropagation(),x()};return e.jsxs(e.Fragment,{children:[e.jsxs(I,{className:"cursor-pointer hover:bg-muted/50",onClick:n,children:[e.jsx(v,{children:e.jsx(N,{variant:"ghost",size:"sm",children:d?e.jsx(Xe,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})})}),e.jsx(v,{className:"font-medium",children:a.customer.name}),e.jsx(v,{children:a.customer.passport_country?e.jsx(K,{variant:"outline",children:a.customer.passport_country}):"N/A"}),e.jsx(v,{children:f(a.status)}),e.jsx(v,{children:p(a.payment_method)}),e.jsx(v,{className:"font-medium",children:j(a.total_price)}),e.jsx(v,{children:h(a.created_at)}),e.jsx(v,{onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:o,className:b?"bg-secondary text-secondary-foreground":"hidden cursor-not-allowed",children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:w,className:"bg-destructive text-destructive-foreground",children:e.jsx(Qe,{className:"h-4 w-4"})})]})})]}),d&&e.jsx(I,{children:e.jsx(v,{colSpan:8,className:"p-4 bg-muted/20",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Customer Information"}),e.jsx("div",{className:"space-y-1 text-sm",children:[{label:"Name",value:a.customer.name},{label:"Email",value:a.customer.email||"N/A"},{label:"Phone",value:a.customer.phone||"N/A"},{label:"Country",value:a.customer.passport_country||"N/A"}].map(t=>e.jsxs("div",{className:"grid grid-cols-5",children:[e.jsx("span",{className:"font-medium col-span-1",children:t.label}),e.jsxs("span",{className:"col-span-4",children:[": ",t.value]})]},t.label))})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Services"}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(oe,{children:[e.jsx(he,{children:e.jsxs(I,{children:[e.jsx(C,{children:"Service"}),e.jsx(C,{children:"Quantity"}),e.jsx(C,{children:"Price/Unit"}),e.jsx(C,{children:"Total"})]})}),e.jsx(me,{children:a.services.map(t=>e.jsxs(I,{children:[e.jsx(v,{children:t.name}),e.jsx(v,{children:t.pivot.quantity}),e.jsx(v,{children:j(t.pivot.price_per_unit)}),e.jsx(v,{children:j(t.pivot.price_per_unit*t.pivot.quantity)})]},t.id))})]})})]})]})})},`${a.id}-details`)]})},es=({orders:a,expandedRows:d,toggleRow:n,openEditModal:r,openDeleteModal:x,getStatusBadge:f,getPaymentBadge:p,formatPrice:j,formatDate:h,sortBy:b,sortDirection:o,handleSort:w})=>{const t=({field:c,children:i})=>e.jsx(C,{className:"cursor-pointer",onClick:()=>w(c),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:i}),b===c&&e.jsx(Ge,{className:`h-3 w-3 ${o==="asc"?"rotate-180":""}`})]})});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(oe,{children:[e.jsx(he,{children:e.jsxs(I,{children:[e.jsx(C,{className:"w-8"}),e.jsx(t,{field:"customer.name",children:"Customer"}),e.jsx(C,{children:"Country"}),e.jsx(t,{field:"status",children:"Status"}),e.jsx(t,{field:"payment_method",children:"Payment"}),e.jsx(C,{children:"Total"}),e.jsx(t,{field:"created_at",children:"Date"}),e.jsx(C,{children:"Actions"})]})}),e.jsxs(me,{children:[console.log(a),a.length>0?a.map(c=>e.jsx(Ze,{order:c,isExpanded:d.includes(c.id),onToggle:()=>n(c.id),onEdit:()=>r(c),onDelete:()=>x(c),getStatusBadge:f,getPaymentBadge:p,formatPrice:j,formatDate:h},c.id)):e.jsx(I,{children:e.jsx(v,{colSpan:8,className:"text-center py-8",children:"No orders found"})})]})]})})},ss=({isOpen:a,onOpenChange:d,onConfirm:n,order:r})=>r?e.jsx($,{open:a,onOpenChange:d,children:e.jsxs(Q,{children:[e.jsxs(J,{children:[e.jsx(W,{children:"Confirm Deletion"}),e.jsxs(X,{children:["Are you sure you want to delete the order for"," ",e.jsx("strong",{children:r.customer.name}),"? This action cannot be undone."]})]}),e.jsxs(G,{children:[e.jsx(N,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(N,{variant:"destructive",onClick:n,children:"Delete"})]})]})}):null,ts=({paginationData:a,buildPaginationUrl:d})=>{const{from:n,to:r,total:x,prev_page_url:f,next_page_url:p}=a,j=h=>{h&&H.get(d(h),{},{preserveState:!0,replace:!0})};return e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",n," to ",r," of ",x," results"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>j(f),disabled:!f,children:"Previous"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>j(p),disabled:!p,children:"Next"})]})]})},as=a=>!a&&a!==0?"N/A":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(a),ie=({data:a,setData:d,errors:n,customers:r,services:x,orderServices:f,updateService:p,updateServiceDetail:j,addService:h,removeService:b,isPending:o=!0,isStatusUpdateOnly:w=!1})=>e.jsxs("div",{className:"grid gap-4 py-4",children:[!w&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"customer_id",className:"text-right",children:"Customer *"}),e.jsxs(_,{value:a.customer_id,onValueChange:t=>d("customer_id",t),children:[e.jsx(D,{className:"col-span-3",children:e.jsx(O,{placeholder:"Select customer"})}),e.jsx(P,{children:r.map(t=>e.jsx(u,{value:t.id.toString(),children:t.name},t.id))})]}),n.customer_id&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:n.customer_id})]}),e.jsx("fieldset",{disabled:!o,children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(M,{className:"text-right pt-2",children:"Services *"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[f.map((t,c)=>e.jsxs("div",{className:"border rounded p-3 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"font-medium",children:["Service #",c+1]}),f.length>1&&e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:()=>b(c),children:e.jsx(ue,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[e.jsx("div",{className:"col-span-7",children:e.jsxs(_,{value:t.id,onValueChange:i=>p(c,"id",i),children:[e.jsx(D,{children:e.jsx(O,{placeholder:"Select service"})}),e.jsx(P,{children:x.map(i=>e.jsx(u,{value:i.id.toString(),children:i.name},i.id))})]})}),e.jsx("div",{className:"col-span-5",children:e.jsx(Y,{type:"number",min:"1",placeholder:"Quantity",value:t.quantity,onChange:i=>p(c,"quantity",parseInt(i.target.value)||1)})})]}),t.id&&(()=>{const i=x.find(y=>y.id===parseInt(t.id));return i?i.type==="selectable"?e.jsxs(_,{value:t.details.package||"",onValueChange:y=>j(c,"package",y),children:[e.jsx(D,{children:e.jsx(O,{placeholder:"Select option"})}),e.jsx(P,{children:i.options?.map((y,k)=>e.jsxs(u,{value:y.name,children:[y.name," ","-"," ",as(y.price)]},k))})]}):i.type==="per_unit"?e.jsx(Y,{type:"number",min:"0",step:"0.01",placeholder:"Weight/Unit",value:t.details.weight||"",onChange:y=>j(c,"weight",parseFloat(y.target.value)||0)}):null:null})()]},c)),e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:h,className:"mt-2",children:[e.jsx(de,{className:"h-4 w-4 mr-1"})," Add Service"]}),n.services&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.services})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"status",className:"text-right",children:"Status *"}),e.jsxs(_,{value:a.status,onValueChange:t=>d("status",t),children:[e.jsx(D,{className:"col-span-3",children:e.jsx(O,{placeholder:"Select status"})}),e.jsxs(P,{children:[e.jsx(u,{value:"pending",children:"Pending"}),e.jsx(u,{value:"paid",children:"Paid"}),e.jsx(u,{value:"cancelled",children:"Cancelled"})]})]}),n.status&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:n.status})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"payment_method",className:"text-right",children:"Payment Method *"}),e.jsxs(_,{value:a.payment_method,onValueChange:t=>d("payment_method",t),disabled:!o,children:[e.jsx(D,{className:"col-span-3",children:e.jsx(O,{placeholder:"Select payment method"})}),e.jsxs(P,{children:[e.jsx(u,{value:"cash",children:"Cash"}),e.jsx(u,{value:"online",children:"Online"})]})]}),n.payment_method&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:n.payment_method})]})]});function ls(){const{orders:a,customers:d,services:n,filters:r,flash:x}=Re().props,f=[...new Set(d.map(s=>s.passport_country).filter(Boolean))],[p,j]=g.useState(r.search||""),[h,b]=g.useState(r.status||"all"),[o,w]=g.useState(r.payment_method||"all"),[t,c]=g.useState(r.country||"all"),[i,y]=g.useState(r.sort_by||"created_at"),[k,R]=g.useState(r.sort_direction||"desc"),[xe,q]=g.useState(!1),[pe,B]=g.useState(!1),[je,z]=g.useState(!1),[E,Z]=g.useState(null),[ge,ve]=g.useState([]),[T,F]=g.useState([{id:"",quantity:1,details:{}}]),fe=E?.status==="pending",{data:ee,setData:A,post:Ne,put:ye,processing:se,errors:te,reset:U,clearErrors:ae}=qe({customer_id:"",services:[{id:"",quantity:1,details:{}}],status:"pending",payment_method:"cash"});g.useEffect(()=>{x?.success&&L.success(x.success),x?.error&&L.error(x.error)},[x]),g.useEffect(()=>{const s=setTimeout(Se,500);return()=>clearTimeout(s)},[p,h,o,t,i,k]);const Se=(s=1)=>{H.get(route("orders.index"),{search:p,status:h==="all"?"":h,country:t==="all"?"":t,payment_method:o==="all"?"":o,sort_by:i,sort_direction:k,per_page:r.per_page,page:s},{preserveState:!0,replace:!0})},be=s=>{i===s?R(k==="asc"?"desc":"asc"):(y(s),R("asc"))},Ce=()=>{U(),ae(),F([{id:"",quantity:1,details:{}}]),q(!0)},we=s=>{const l=s.services.map(m=>({id:m.id,quantity:m.pivot.quantity,details:JSON.parse(m.pivot.details||"{}")}));A({customer_id:s.customer_id,services:l,status:s.status,payment_method:s.payment_method}),F(l),ae(),Z(s),B(!0)},_e=s=>{Z(s),z(!0)},De=s=>{s.preventDefault(),Ne(route("orders.store"),{onSuccess:()=>{q(!1),U()}})},Oe=s=>{s.preventDefault(),ye(route("orders.update",E.id),{onSuccess:()=>{B(!1),U()}})},Pe=()=>{H.delete(route("orders.destroy",E.id),{onSuccess:()=>z(!1)})},ke=()=>{j(""),b("all"),w("all"),c("all"),y("created_at"),R("desc")},Te=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(s||0),Ae=s=>new Date(s).toLocaleDateString(),Fe=s=>{let l="secondary";switch(s){case"pending":l="warning";break;case"paid":l="success";break;case"cancelled":l="destructive";break;default:l="outline"}return e.jsx(K,{variant:l,className:"capitalize px-2 py-1 text-xs font-medium",children:s})},Ie=s=>{let l="secondary";switch(s){case"cash":l="purple";break;case"online":l="info";break;default:l="outline"}return e.jsx(K,{variant:l,className:"capitalize px-2 py-1 text-xs font-medium",children:s})},Ee=s=>ve(l=>l.includes(s)?l.filter(m=>m!==s):[...l,s]),le=()=>{const s=[...T,{id:"",quantity:1,details:{}}];F(s),A("services",s)},ne=s=>{if(T.length<=1)return;const l=T.filter((m,S)=>S!==s);F(l),A("services",l)},re=(s,l,m)=>{const S=[...T];S[s]={...S[s],[l]:m},l==="id"&&(S[s].details={}),F(S),A("services",S)},ce=(s,l,m)=>{const S=[...T];S[s].details={...S[s].details,[l]:m},F(S),A("services",S)},Me=s=>{if(!s)return null;const l=new URL(s),m=new URLSearchParams(l.search);return m.set("search",p),m.set("status",h==="all"?"":h),m.set("payment_method",o==="all"?"":o),m.set("sort_by",i),m.set("sort_direction",k),`${l.pathname}?${m.toString()}`};return e.jsxs("div",{className:"container mx-auto py-2 px-4",children:[e.jsxs(Ve,{className:"mb-8",children:[e.jsx(Ke,{onAddOrder:Ce}),e.jsxs(He,{children:[e.jsx(Ye,{searchTerm:p,setSearchTerm:j,selectedStatus:h,setSelectedStatus:b,selectedPaymentMethod:o,setSelectedPaymentMethod:w,selectedCountry:t,setSelectedCountry:c,clearFilters:ke,countries:f}),e.jsx(es,{orders:a,expandedRows:ge,toggleRow:Ee,openEditModal:we,openDeleteModal:_e,getStatusBadge:Fe,getPaymentBadge:Ie,formatPrice:Te,formatDate:Ae,sortBy:i,sortDirection:k,handleSort:be}),e.jsx(ts,{paginationData:a,buildPaginationUrl:Me})]})]}),e.jsx($,{open:xe,onOpenChange:q,children:e.jsxs(Q,{className:"sm:max-w-[700px]",children:[e.jsxs(J,{children:[e.jsx(W,{children:"Create New Order"}),e.jsx(X,{children:"Add a new customer order"})]}),e.jsxs("form",{onSubmit:De,children:[e.jsx(ie,{data:ee,setData:A,errors:te,customers:d,services:n,orderServices:T,updateService:re,updateServiceDetail:ce,addService:le,removeService:ne}),e.jsx(G,{children:e.jsx(N,{type:"submit",disabled:se,children:"Create Order"})})]})]})}),e.jsx($,{open:pe,onOpenChange:B,children:e.jsxs(Q,{className:"sm:max-w-[700px]",children:[e.jsxs(J,{children:[e.jsx(W,{children:"Edit Order Status"}),e.jsx(X,{children:"Only status and payment method can be changed."})]}),e.jsxs("form",{onSubmit:Oe,children:[e.jsx(ie,{data:ee,setData:A,errors:te,customers:d,services:n,orderServices:T,updateService:re,updateServiceDetail:ce,addService:le,removeService:ne,isPending:fe,isStatusUpdateOnly:!0}),e.jsx(G,{children:e.jsx(N,{type:"submit",disabled:se,children:"Update Order"})})]})]})}),e.jsx(ss,{isOpen:je,onOpenChange:z,onConfirm:Pe,order:E})]})}ls.layout=a=>e.jsx(Je,{children:a});export{ls as default};
