import{u as H,r,j as a,H as M,L as Q,b as K}from"./app-DJl2ydn2.js";import{A as z}from"./AuthenticatedLayout-C8pa3ZP2.js";import{S as J}from"./ServiceForm-CVYH1P3m.js";import{B as h}from"./button-BcKuhJzw.js";import{C as V,a as W,b as X,d as Y}from"./card-q4U6RwoP.js";/* empty css            */import"./index-DjLYN8p0.js";import"./index-CNtyiCxP.js";import"./input-ksvuRPG_.js";import"./label-xh0tx8M8.js";import"./select-D32KVn18.js";import"./index-2z52CgDs.js";import"./chevron-down-lmp7wB3O.js";import"./plus-p-3jHoRd.js";import"./circle-question-mark-t8hdwJg1.js";import"./image-C4tNnfhw.js";import"./loader-circle-CjFAv75S.js";import"./arrow-right-Ds5sFVJ9.js";function ye({service:o,categories:x}){const{data:i,setData:c,processing:g,errors:w}=H({name:o.name||"",description:o.description||"",type:o.type||"fixed",category_id:o.category_id||null,fulfillment_type:o.fulfillment_type||"direct",offering_session:o.offering_session||"post_checkin",price:o.price||"",unit_name:o.unit_name||"",options:o.options&&o.options.length>0?o.options.map(e=>({key:e.key,name:e.name,price:e.price})):[{name:"",price:""}],has_questions:o.has_active_questions||!1,questions:o.active_question?.questions_json||[""]}),[j,O]=r.useState(!0),E=r.useMemo(()=>{const e={},t=o.optionImages||o.option_images||[];return Array.isArray(t)&&t.forEach(n=>{const s=n.option_key||"unknown";e[s]||(e[s]=[]),e[s].push({...n,url:n.url||`/storage/${n.image_path}`})}),e},[o.option_images]),I=r.useMemo(()=>o.images||[],[o.images]),[S,q]=r.useState([]),[k,b]=r.useState([]),[_,d]=r.useState([]),[D,l]=r.useState([]),[y,u]=r.useState({}),[$,f]=r.useState({}),[A]=r.useState(o.has_active_questions||!1),[G]=r.useState(o.active_question?.questions_json||[""]);r.useEffect(()=>{O(!1)},[]);const N=()=>{c("options",[...i.options,{name:"",price:""}])},F=e=>{if(i.options.length<=1)return;const n=i.options[e].key||`opt_${e+1}`,s=i.options.filter((m,p)=>p!==e);c("options",s),setExistingOptionImagesByKey(m=>{const p={...m};return delete p[n],p}),u(m=>{const p={...m};return delete p[n],p}),f(m=>{const p={...m};return delete p[n],p})},L=(e,t,n)=>{const s=[...i.options];s[e][t]=n,c("options",s)},C=e=>{setExistingGeneralImages(t=>t.filter(n=>n.id!==e)),q(t=>[...t,e])},U=(e,t)=>{setExistingOptionImagesByKey(n=>{const s={...n};return s[t]&&(s[t]=s[t].filter(m=>m.id!==e)),s}),b(n=>[...n,e])},v=e=>{l(t=>t.filter((n,s)=>s!==e)),d(t=>t.filter((n,s)=>s!==e))},P=(e,t)=>{const n=t?.[0];n&&(u(s=>({...s,[e]:n})),f(s=>({...s,[e]:URL.createObjectURL(n)})))},T=e=>{const t=Array.from(e||[]);if(!t.length)return;const n=t.map(s=>({file:s,url:URL.createObjectURL(s)}));d(s=>[...s,...t]),l(s=>[...s,...n])},B=()=>{const e=new FormData;return e.append("_method","PUT"),e.append("name",i.name??""),e.append("description",i.description??""),e.append("type",i.type??""),e.append("category_id",i.category_id??""),e.append("fulfillment_type",i.fulfillment_type??""),e.append("offering_session",i.offering_session??""),e.append("price",i.price??""),e.append("unit_name",i.unit_name??""),e.append("has_questions",i.has_questions?"1":"0"),i.has_questions&&Array.isArray(i.questions)&&i.questions.forEach((t,n)=>{e.append(`questions[${n}]`,t??"")}),Array.isArray(i.options)&&i.options.forEach((t,n)=>{e.append(`options[${n}][name]`,t.name??""),e.append(`options[${n}][price]`,t.price??""),t.key&&e.append(`options[${n}][key]`,t.key)}),S.forEach((t,n)=>{e.append(`images_to_delete[${n}]`,t)}),k.forEach((t,n)=>{e.append(`option_images_to_delete[${n}]`,t)}),_.forEach((t,n)=>{t&&e.append(`images[${n}]`,t)}),Object.entries(y).forEach(([t,n])=>{n&&e.append(`option_images_new[${t}]`,n)}),e},R=e=>{e.preventDefault();const t=B();K.post(route("services.update",o.id),t,{forceFormData:!0,onSuccess:()=>{},onError:()=>{}})};return a.jsxs(z,{children:[a.jsx(M,{title:`Edit Service: ${o.name}`}),a.jsx("div",{className:"container mx-auto py-2 px-4",children:a.jsx("form",{onSubmit:R,children:a.jsxs(V,{children:[a.jsxs(W,{className:"flex flex-row items-center justify-between",children:[a.jsx("div",{children:a.jsx(X,{children:"Edit Service"})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Q,{href:route("services.index"),children:a.jsx(h,{type:"button",variant:"outline",children:"Cancel"})}),a.jsx(h,{type:"submit",disabled:g,children:g?"Saving...":"Update Service"})]})]}),a.jsx(Y,{children:a.jsx(J,{mode:"edit",data:i,setData:c,categories:x||[],errors:w,addOption:N,removeOption:F,updateOption:L,initialHasQuestions:A,initialQuestions:G,existingGeneralImages:I,existingOptionImagesByKey:E,markDeleteGeneralImage:C,markDeleteOptionImage:U,newGeneralImages:_,newGeneralPreviews:D,setNewGeneralImages:d,setNewGeneralPreviews:l,newOptionImages:y,newOptionImagePreviews:$,setNewOptionImages:u,setNewOptionImagePreviews:f,handleReplaceOptionImage:P,addNewGeneralImages:T,removeNewGeneralPreview:v,loadingImagesForEdit:j})})]})})})]})}export{ye as default};
