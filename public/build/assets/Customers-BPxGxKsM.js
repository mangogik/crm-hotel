import{j as e,r as n,b as H,c as Se,u as we}from"./app-EWpIB3HM.js";import{B as p}from"./button-H6AwmmAM.js";import{a as De,b as Te,c as ke,C as Ae,d as Me}from"./card-RKJWBewB.js";import{P as Re,D as R,a as Ee,b as E,c as O,d as B,C as Oe,e as Be,T as Pe,f as I,g as $,t as J}from"./index-CkhVk1HJ.js";import{X as Fe,A as Le}from"./AuthenticatedLayout-DQWAbSsw.js";import{I as M}from"./index-BIX3n7Yj.js";import{L as z}from"./label-CzG679bL.js";import{S as Ue,a as K,b as Q,F as Y,c as Z,d as ee,e as se,C as He,A as Ie}from"./select-DuMT9J0t.js";import{C as $e}from"./calendar-nZAC3HMz.js";import{T as S,a as j,B as A,b as ae,c as re,d as C,e as le}from"./badge-CSf3a6Wm.js";/* empty css            */import"./index-6H-wcPrJ.js";import"./index-CaT8ubQ7.js";const ze=({onAddCustomer:s})=>e.jsx(De,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(Te,{className:"text-2xl font-bold",children:"Customers"}),e.jsx(ke,{children:"Manage your customer database"})]}),e.jsxs(p,{onClick:s,className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"})," Add Customer"]})]})}),Ve=({searchTerm:s,setSearchTerm:r,selectedCountry:i,setSelectedCountry:c,selectedMembership:l,setSelectedMembership:d,lastVisitFrom:h,setLastVisitFrom:u,lastVisitTo:x,setLastVisitTo:t,clearFilters:m,countries:v})=>{const T=[{value:"all",label:"All Memberships"},{value:"regular",label:"Regular"},{value:"silver",label:"Silver"},{value:"gold",label:"Gold"},{value:"platinum",label:"Platinum"}],[N,y]=n.useState(!1),[b,w]=n.useState(h),[k,_]=n.useState(x),P=()=>{u(b),t(k),y(!1)},D=()=>{w(""),_(""),u(""),t(""),y(!1)},F=()=>!h&&!x?"Select Last Visit Range":h&&!x?h:h&&x?`${h} - ${x}`:"Select Last Visit Range";return e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(M,{placeholder:"Search customers...",value:s,onChange:o=>r(o.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(K,{value:i,onValueChange:c,children:[e.jsxs(Q,{className:"w-full md:w-[180px]",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),e.jsx(Z,{placeholder:"Country"})]}),e.jsx(ee,{children:v.map(o=>e.jsx(se,{value:o,children:o==="all"?"All Countries":o},o))})]}),e.jsxs(K,{value:l,onValueChange:d,children:[e.jsxs(Q,{className:"w-full md:w-[180px]",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),e.jsx(Z,{placeholder:"Membership"})]}),e.jsx(ee,{children:T.map(o=>e.jsx(se,{value:o.value,children:o.label},o.value))})]}),e.jsxs(R,{open:N,onOpenChange:y,children:[e.jsx(Ee,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"w-full md:w-52 justify-center text-left font-normal",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),F()]})}),e.jsxs(E,{className:"sm:max-w-96",children:[e.jsx(O,{children:e.jsx(B,{children:"Select Last Visit Range"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"from-date",children:"From Date"}),e.jsx(M,{id:"from-date",type:"date",value:b,onChange:o=>w(o.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"to-date",children:"To Date"}),e.jsx(M,{id:"to-date",type:"date",value:k,onChange:o=>_(o.target.value)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(p,{variant:"outline",onClick:D,children:"Clear"}),e.jsx(p,{onClick:P,children:"Apply"})]})]})]})]}),e.jsxs(p,{variant:"outline",onClick:m,className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"})," Clear"]})]})]})},qe=({customer:s,isExpanded:r,onToggle:i,onEdit:c,onDelete:l,formatDate:d})=>{const h=t=>{switch(t){case"platinum":return"default";case"gold":return"warning";case"silver":return"outline";default:return"destructive"}},u=t=>{switch(t){case"checked_in":return"default";case"reserved":return"secondary";case"checked_out":return"outline";default:return"destructive"}},x=t=>t.split("_").map(m=>m.charAt(0).toUpperCase()+m.slice(1).toLowerCase()).join(" ");return e.jsxs(e.Fragment,{children:[e.jsxs(S,{className:"cursor-pointer hover:bg-muted/50",onClick:i,children:[e.jsx(j,{children:e.jsx(p,{variant:"ghost",size:"sm",children:r?e.jsx(He,{className:"h-4 w-4"}):e.jsx(Oe,{className:"h-4 w-4"})})}),e.jsx(j,{className:"font-medium",children:s.name}),e.jsx(j,{children:s.email||"N/A"}),e.jsx(j,{children:s.phone||"N/A"}),e.jsx(j,{children:s.passport_country&&e.jsx(A,{variant:"outline",children:s.passport_country})}),e.jsx(j,{children:e.jsxs(A,{variant:"outline",children:[s.total_visits," ",s.total_visits>1?"Visits":"Visit"]})}),e.jsx(j,{children:s.membership?e.jsxs(A,{variant:h(s.membership.membership_type),children:[x(s.membership.membership_type),s.membership.discount_percentage>0&&` (${s.membership.discount_percentage}%)`]}):e.jsx("span",{className:"text-muted-foreground",children:"None"})}),e.jsx(j,{onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:c,className:"bg-secondary text-secondary-foreground",children:e.jsx(Be,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:l,className:"bg-destructive text-destructive-foreground",children:e.jsx(Pe,{className:"h-4 w-4"})})]})})]}),r&&e.jsx(S,{children:e.jsx(j,{colSpan:8,className:"p-4 bg-muted/20",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.notes||"No notes for this customer."})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Booking History"}),s.bookings&&s.bookings.length>0?e.jsx("div",{className:"border rounded-md",children:e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(S,{children:[e.jsx(C,{children:"Check-in Date"}),e.jsx(C,{children:"Room"}),e.jsx(C,{children:"Status"})]})}),e.jsx(le,{children:s.bookings.map(t=>e.jsxs(S,{children:[e.jsx(j,{children:d(t.checkin_at)}),e.jsx(j,{children:t.room_number||"N/A"}),e.jsx(j,{children:e.jsx(A,{variant:u(t.status),children:x(t.status)})})]},t.id))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No booking history found."})]})]})})},`${s.id}-details`)]})},Ge=({customers:s,expandedRows:r,toggleRow:i,openEditModal:c,openDeleteModal:l,formatDate:d,sortBy:h,sortDirection:u,handleSort:x})=>{const t=({field:m,children:v})=>e.jsx(C,{className:"cursor-pointer",onClick:()=>x(m),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:v}),h===m&&e.jsx(Ie,{className:`h-3 w-3 ${u==="asc"?"rotate-180":""}`})]})});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(S,{children:[e.jsx(C,{className:"w-8"}),e.jsx(t,{field:"name",children:"Name"}),e.jsx(t,{field:"email",children:"Email"}),e.jsx(t,{field:"phone",children:"Phone"}),e.jsx(t,{field:"passport_country",children:"Country"}),e.jsx(t,{field:"total_visits",children:"Visits"}),e.jsx(C,{children:"Membership"}),e.jsx(C,{children:"Actions"})]})}),e.jsxs(le,{children:[console.table(s),s.length>0?s.map(m=>e.jsx(qe,{customer:m,isExpanded:r.includes(m.id),onToggle:()=>i(m.id),onEdit:()=>c(m),onDelete:()=>l(m),formatDate:d},m.id)):e.jsx(S,{children:e.jsx(j,{colSpan:9,className:"text-center py-8",children:"No customers found"})})]})]})})},te=({data:s,setData:r,errors:i})=>{const c=[{id:"name",label:"Name *",type:"text"},{id:"email",label:"Email",type:"email"},{id:"phone",label:"Phone",type:"text"},{id:"passport_country",label:"Country",type:"text"},{id:"notes",label:"Notes",type:"text"}];return e.jsx("div",{className:"grid gap-4 py-4",children:c.map(l=>e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(z,{htmlFor:l.id,className:"text-right",children:l.label}),e.jsx(M,{id:l.id,type:l.type,value:s[l.id]||"",onChange:d=>r(l.id,d.target.value),className:"col-span-3"}),i[l.id]&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-right",children:i[l.id]})]},l.id))})},We=({isOpen:s,onOpenChange:r,onConfirm:i,customer:c})=>c?e.jsx(R,{open:s,onOpenChange:r,children:e.jsxs(E,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Confirm Deletion"}),e.jsxs(I,{children:["Are you sure you want to delete ",e.jsx("strong",{children:c.name}),"? This action cannot be undone."]})]}),e.jsxs($,{children:[e.jsx(p,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsx(p,{variant:"destructive",onClick:i,children:"Delete"})]})]})}):null,Xe=({paginationData:s,buildPaginationUrl:r})=>{const{from:i,to:c,total:l,prev_page_url:d,next_page_url:h,current_page:u}=s,x=t=>{t&&H.get(r(t),{},{preserveState:!0,replace:!0})};return e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",i," to ",c," of ",l," results"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>x(d),disabled:!d,children:"Previous"}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>x(h),disabled:!h,children:"Next"})]})]})};function Je(){const{customers:s,filters:r,flash:i}=Se().props,[c,l]=n.useState(r.search||""),[d,h]=n.useState(r.passport_country||"all"),[u,x]=n.useState(r.membership_type||"all"),[t,m]=n.useState(r.last_visit_from||""),[v,T]=n.useState(r.last_visit_to||""),[N,y]=n.useState(r.sort_by||"created_at"),[b,w]=n.useState(r.sort_direction||"desc"),[k,_]=n.useState(!1),[P,D]=n.useState(!1),[F,o]=n.useState(!1),[L,V]=n.useState(null),[ne,ie]=n.useState(["all"]),[oe,ce]=n.useState([]),{data:q,setData:U,post:de,put:me,processing:G,errors:W,reset:he,clearErrors:X}=we({name:"",email:"",phone:"",passport_country:"",notes:""});n.useEffect(()=>{const a=[...new Set(s.data.map(g=>g.passport_country).filter(Boolean))];ie(["all",...a])},[s]),n.useEffect(()=>{i?.success&&J.success(i.success),i?.error&&J.error(i.error)},[i]),n.useEffect(()=>{const a=setTimeout(()=>xe(1),500);return()=>clearTimeout(a)},[c,d,u,t,v,N,b]);const xe=(a=r.page||1)=>{H.get(route("customers.index"),{search:c,passport_country:d==="all"?"":d,membership_type:u==="all"?"":u,last_visit_from:t,last_visit_to:v,sort_by:N,sort_direction:b,page:a},{preserveState:!0,replace:!0})},ue=a=>{y(a),w(g=>g==="asc"?"desc":"asc")},pe=()=>{he(),X(),_(!0)},je=a=>{U({name:a.name,email:a.email||"",phone:a.phone||"",passport_country:a.passport_country||"",notes:a.notes||""}),X(),V(a),D(!0)},ge=a=>{V(a),o(!0)},fe=a=>{a.preventDefault(),de(route("customers.store"),{onSuccess:()=>_(!1)})},ve=a=>{a.preventDefault(),me(route("customers.update",L.id),{onSuccess:()=>D(!1)})},be=()=>{H.delete(route("customers.destroy",L.id),{onSuccess:()=>o(!1)})},Ce=()=>{l(""),h("all"),x("all"),m(""),T(""),y("created_at"),w("desc")},Ne=a=>a?new Date(a).toLocaleDateString():"N/A",ye=a=>ce(g=>g.includes(a)?g.filter(f=>f!==a):[...g,a]),_e=a=>{if(!a)return null;const g=new URL(a),f=new URLSearchParams(g.search);return f.set("search",c),f.set("passport_country",d==="all"?"":d),f.set("membership_type",u==="all"?"":u),f.set("last_visit_from",t),f.set("last_visit_to",v),f.set("sort_by",N),f.set("sort_direction",b),`${g.pathname}?${f.toString()}`};return e.jsxs("div",{className:"container mx-auto py-2 px-4",children:[e.jsxs(Ae,{className:"mb-8",children:[e.jsx(ze,{onAddCustomer:pe}),e.jsxs(Me,{children:[e.jsx(Ve,{searchTerm:c,setSearchTerm:l,selectedCountry:d,setSelectedCountry:h,selectedMembership:u,setSelectedMembership:x,lastVisitFrom:t,setLastVisitFrom:m,lastVisitTo:v,setLastVisitTo:T,clearFilters:Ce,countries:ne}),e.jsx(Ge,{customers:s.data,expandedRows:oe,toggleRow:ye,openEditModal:je,openDeleteModal:ge,formatDate:Ne,sortBy:N,sortDirection:b,handleSort:ue}),e.jsx(Xe,{paginationData:s,buildPaginationUrl:_e})]})]}),e.jsx(R,{open:k,onOpenChange:_,children:e.jsxs(E,{className:"sm:max-w-[425px]",children:[e.jsxs(O,{children:[e.jsx(B,{children:"Create New Customer"}),e.jsx(I,{children:"Add a new customer to your database"})]}),e.jsxs("form",{onSubmit:fe,children:[e.jsx(te,{data:q,setData:U,errors:W}),e.jsx($,{children:e.jsx(p,{type:"submit",disabled:G,children:"Create Customer"})})]})]})}),e.jsx(R,{open:P,onOpenChange:D,children:e.jsxs(E,{className:"sm:max-w-[425px]",children:[e.jsxs(O,{children:[e.jsx(B,{children:"Edit Customer"}),e.jsx(I,{children:"Update customer information"})]}),e.jsxs("form",{onSubmit:ve,children:[e.jsx(te,{data:q,setData:U,errors:W}),e.jsx($,{children:e.jsx(p,{type:"submit",disabled:G,children:"Update Customer"})})]})]})}),e.jsx(We,{isOpen:F,onOpenChange:o,onConfirm:be,customer:L})]})}Je.layout=s=>e.jsx(Le,{children:s});export{Je as default};
